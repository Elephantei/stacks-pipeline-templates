parameters:
  filter: 'label=test=true'
  destination: '$(Common.TestResultsDirectory) '
  search: false
  searchfolders: ''
  searchfilter : ''
  sourceFolder : ''
  testresultsfiles: '**/*.trx'
  testResultsFormat: 'VSTest'
  

steps:
- task: DockerExtractFiles@0
  displayName : 'Extract Test Results'
  inputs:
    destination: ${{ parameters.destination }}
    filter: ${{ parameters.filter }}
    sourcefolder: ${{ parameters.sourceFolder }}
    search: ${{ parameters.search }}
    searchfolders: ${{ parameters.searchfolders }}
    filestring: ${{ parameters.searchfilter }}
  condition: always()

- ${{ if eq(variables['system.debug'], true) }}:
  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: 'Get-ChildItem -Path ${{ parameters.destination }} -Recurse'
    condition : always()


- task: PublishTestResults@2
  displayName : 'Publish To Test Results'
  inputs:
    testResultsFormat: ${{ parameters.testResultsFormat }}
    testResultsFiles: ${{ parameters.testresultsfiles }}
    searchFolder: ${{ parameters.destination }}
    failTaskOnFailedTests: true
  condition : always()