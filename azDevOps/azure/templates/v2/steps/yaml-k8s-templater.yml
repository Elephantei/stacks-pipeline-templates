parameters:
  # template_input: [{base: "", out: "", env_vars: {}}]
  template_input: []
  scripts_dir: ""

steps:
  #####################
  ## Templating task ##
  ## :inputs: Array(base: string, out: string, env_vars: map) -
  ## :inputs.base: string - file path to base yaml template with shell style variables as place holders
  ## :inputs.out: string - file path to outputted yaml with replaced variables inside the template
  ## ==> if empty will default to base file and stripping out the `base_` from name
  ## if convention is followed no need to specify out and only pass
  ##
  ## :inputs.env_vars: map - key/value string pairs to replace per file
  #####################
  - ${{ each tpl in parameters.template_input }}:
      - bash: |
          ./yaml-templating.sh ${{ tpl.base }} ${{ tpl.out }}
        displayName: "K8s: Yaml ${{ tpl.displayName }}"
        failOnStderr: true
        workingDirectory: ${{ parameters.scripts_dir }}
        env:
          ${{ each var in tpl.env_vars }}:
            ${{ var.key }}: ${{ var.value }}
